<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CMC – Editor Móvil</title>

<style>
body {
  background: #0c0e12;
  color: #eee;
  font-family: Arial, sans-serif;
  padding: 20px;
}

label { margin-top: 10px; display: block; }

input, select, textarea {
  width: 100%;
  padding: 10px;
  background: #1a1d22;
  color: #eee;
  border: 1px solid #444;
  border-radius: 6px;
  margin-bottom: 10px;
}

button {
  padding: 12px;
  background: #4d88ff;
  border: none;
  border-radius: 6px;
  color: white;
  width: 100%;
  margin-top: 10px;
  cursor: pointer;
}

#render, #jsonOutput {
  margin-top: 20px;
  background: #111;
  padding: 15px;
  border-radius: 6px;
  white-space: pre-wrap;
}

#downloadLink {
  display: none;
  margin-top: 10px;
  padding: 10px;
  background: #2a9d8f;
  text-align: center;
  border-radius: 6px;
  color: white;
}
</style>

</head>
<body>

<h2>CMC – Editor Móvil</h2>

<label>Título</label>
<input id="title">

<label>Autor</label>
<select id="author">
  <option>Ámbar</option>
  <option>Velvet</option>
  <option>Éter</option>
  <option>Nebula</option>
  <option>Brujo</option>
</select>

<label>Tags (coma)</label>
<input id="tags">

<label>Contenido (Markdown)</label>
<textarea id="content" oninput="updatePreview()"></textarea>

<button onclick="generateJSON()">Generar JSON</button>
<button onclick="copyJSON()">Copiar JSON</button>

<a id="downloadLink">Descargar JSON</a>

<div id="render"></div>
<div id="jsonOutput"></div>

<textarea id="hiddenCopy" style="opacity:0;position:absolute;left:-9999px;"></textarea>

<script>
// Markdown simple → HTML
function mdToHtml(md) {
  return md
    .replace(/^# (.*$)/gim, "<h1>$1</h1>")
    .replace(/^## (.*$)/gim, "<h2>$1</h2>")
    .replace(/\*\*(.*?)\*\*/gim, "<b>$1</b>")
    .replace(/\*(.*?)\*/gim, "<i>$1</i>")
    .replace(/\n/g, "<br>");
}

function updatePreview() {
  document.getElementById("render").innerHTML =
    mdToHtml(document.getElementById("content").value);
}

// Escape para JSON
function escapeForJson(text) {
  return text
    .replace(/\\/g, "\\\\")
    .replace(/\"/g, "\\\"")
    .replace(/\n/g, "\\n");
}

// Generar JSON
function generateJSON() {
  const json = {
    title: title.value.trim(),
    author: author.value,
    date: new Date().toISOString().split("T")[0],
    tags: tags.value.split(",").map(t => t.trim()).filter(t => t),
    content: escapeForJson(content.value)
  };

  const pretty = JSON.stringify(json, null, 2);
  jsonOutput.textContent = pretty;

  // Crear link de descarga REAL
  const blob = new Blob([pretty], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const link = document.getElementById("downloadLink");
  link.href = url;
  link.download = json.title + ".json";
  link.style.display = "block";
}

// Copiar JSON en Android (método 100% compatible)
function copyJSON() {
  const text = jsonOutput.textContent;
  const hidden = document.getElementById("hiddenCopy");
  hidden.value = text;
  hidden.select();
  hidden.setSelectionRange(0, 999999);
  document.execCommand("copy");
  alert("JSON copiado ✔️");
}
</script>

</body>
</html>
